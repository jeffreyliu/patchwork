"use strict";!function(e,t){function u(e){if(!e.forEach)e.forEach=function(e){var t,n=this.length;for(t=0;t<n;t++)e(this[t],t,n)};return e}var n=Float32Array,r=Math.sqrt,i=function(e){return Math.pow(e,2)},s,o;e.isComplexArray=s=function(e){return e!==t&&e.hasOwnProperty!==t&&e.hasOwnProperty("real")&&e.hasOwnProperty("imag")};e.ComplexArray=o=function(e,t){if(s(e)){this.ArrayType=e.ArrayType;this.real=new this.ArrayType(e.real);this.imag=new this.ArrayType(e.imag)}else{this.ArrayType=t||n;this.real=new this.ArrayType(e);this.imag=new this.ArrayType(this.real.length)}this.length=this.real.length};o.prototype.toString=function(){var e=[];this.forEach(function(t,n){e.push("("+t.real.toFixed(2)+","+t.imag.toFixed(2)+")")});return"["+e.join(",")+"]"};o.prototype.map=function(e){var t,n=this.length,r={};for(t=0;t<n;t++){r.real=this.real[t];r.imag=this.imag[t];e(r,t,n);this.real[t]=r.real;this.imag[t]=r.imag}return this};o.prototype.forEach=function(e){var t,n=this.length,r={};for(t=0;t<n;t++){r.real=this.real[t];r.imag=this.imag[t];e(r,t,n)}};o.prototype.conjugate=function(){return(new o(this)).map(function(e){e.imag*=-1})};o.prototype.magnitude=function(){var e=new this.ArrayType(this.length);this.forEach(function(t,n){e[n]=r(i(t.real)+i(t.imag))});return u(e)}}(typeof exports==="undefined"&&(this.complex_array={})||exports);"use strict";!function(e,t){function a(e){return t.isComplexArray(e)&&e||new n(e)}function f(e,t){var n=e.length;if(n&n-1){return l(e,t)}else{return c(e,t)}}function l(e,t){var i=e.length,a,l,c,h,p,v,m,g,y,b,w,E,S,x;if(i===1){return e}c=new n(i,e.ArrayType);g=d(i);y=i/g;b=1/s(g);w=new n(y,e.ArrayType);for(l=0;l<g;l++){for(a=0;a<y;a++){w.real[a]=e.real[a*g+l];w.imag[a]=e.imag[a*g+l]}if(y>1){w=f(w,t)}v=o(2*r*l/i);m=(t?-1:1)*u(2*r*l/i);h=1;p=0;for(a=0;a<i;a++){S=w.real[a%y];x=w.imag[a%y];c.real[a]+=h*S-p*x;c.imag[a]+=h*x+p*S;E=h*v-p*m;p=h*m+p*v;h=E}}for(a=0;a<i;a++){e.real[a]=b*c.real[a];e.imag[a]=b*c.imag[a]}return e}function c(e,t){var n=e.length,s,a,f,l,c,h,d,v,m,g,y,b,w,E,S,x,T;f=p(e);l=f.real;c=f.imag;T=1;while(T<n){v=o(r/T);m=(t?-1:1)*u(r/T);for(s=0;s<n/(2*T);s++){h=1;d=0;for(a=0;a<T;a++){y=2*s*T+a;b=y+T;w=l[y];E=c[y];S=h*l[b]-d*c[b];x=d*l[b]+h*c[b];l[y]=i*(w+S);c[y]=i*(E+x);l[b]=i*(w-S);c[b]=i*(E-x);g=h*v-d*m;d=h*m+d*v;h=g}}T<<=1}return f}function h(e,t){var n=0;while(t>1){n<<=1;n+=e&1;e>>=1;t>>=1}return n}function p(e){var t=e.length,n={},r,i;for(i=0;i<t;i++){var s=h(i,t);if(n.hasOwnProperty(i)||n.hasOwnProperty(s))continue;r=e.real[s];e.real[s]=e.real[i];e.real[i]=r;r=e.imag[s];e.imag[s]=e.imag[i];e.imag[i]=r;n[i]=n[s]=true}return e}function d(e){var t=3,n=s(e);while(t<=n){if(e%t===0)return t;t=t+2}return e}var n=t.ComplexArray,r=Math.PI,i=Math.SQRT1_2,s=Math.sqrt,o=Math.cos,u=Math.sin;n.prototype.FFT=function(){return f(this,false)};e.FFT=function(e){return a(e).FFT()};n.prototype.InvFFT=function(){return f(this,true)};e.InvFFT=function(e){return a(e).InvFFT()};n.prototype.frequencyMap=function(e){return this.FFT().map(e).InvFFT()};e.frequencyMap=function(e,t){return a(e).frequencyMap(t)}}(typeof exports==="undefined"&&(this.fft={})||exports,typeof require==="undefined"&&this.complex_array||require("./complex_array"));var Meyda=function(e,t,n,r){var i=n?n:256;var s=false;var o;var u=function(e,t){var n=0;var r=0;for(var i=0;i<t.length;i++){n+=Math.pow(i,e)*Math.abs(t[i]);r+=t[i]}return n/r};var a=function(e){while(e%2==0&&e>1){e/=2}return e==1};var f=function(e){var t=Float32Array(e.length);var n=Float32Array(e.length);for(var r=0;r<e.length;r++){t[r]=.5-.5*Math.cos(2*Math.PI*r/(e.length-1));n[r]=e[r]*t[r]}return n};var l=this;if(a(i)&&e){l.featureInfo={buffer:{type:"array"},rms:{type:"number"},energy:{type:"number"},zcr:{type:"number"},complexSpectrum:{type:"multipleArrays",arrayNames:{1:"real",2:"imag"}},amplitudeSpectrum:{type:"array"},powerSpectrum:{type:"array"},spectralCentroid:{type:"number"},spectralFlatness:{type:"number"},spectralSlope:{type:"number"},spectralRolloff:{type:"number"},spectralSpread:{type:"number"},spectralSkewness:{type:"number"},spectralKurtosis:{type:"number"},loudness:{type:"multipleArrays",arrayNames:{1:"total",2:"specific"}},perceptualSpread:{type:"number"},perceptualSharpness:{type:"number"},mfcc:{type:"array"}};l.featureExtractors={buffer:function(e,t){return t.signal},rms:function(e,t){var n=0;for(var r=0;r<t.signal.length;r++){n+=Math.pow(t.signal[r],2)}n=n/t.signal.length;n=Math.sqrt(n);return n},energy:function(e,t){var n=0;for(var r=0;r<t.signal.length;r++){n+=Math.pow(Math.abs(t.signal[r]),2)}return n},complexSpectrum:function(e,t){return t.complexSpectrum},spectralSlope:function(e,t){var n=0;var r=0;var i=new Float32Array(t.ampSpectrum.length);var s=0;var o=0;for(var u=0;u<t.ampSpectrum.length;u++){n+=t.ampSpectrum[u];var a=u*t.audioContext.sampleRate/e;i[u]=a;s+=a*a;r+=a;o+=a*t.ampSpectrum[u]}return(t.ampSpectrum.length*o-r*n)/(n*(s-Math.pow(r,2)))},spectralCentroid:function(e,t){return u(1,t.ampSpectrum)},spectralRolloff:function(e,t){var n=t.ampSpectrum;var r=t.audioContext.sampleRate/(2*(n.length-1));var i=0;for(var s=0;s<n.length;s++){i+=n[s]}var o=.99*i;var u=n.length-1;while(i>o&&u>=0){i-=n[u];--u}return(u+1)*r},spectralFlatness:function(e,t){var n=t.ampSpectrum;var r=0;var i=0;for(var s=0;s<n.length;s++){r+=Math.log(n[s]);i+=n[s]}return Math.exp(r/n.length)*n.length/i},spectralSpread:function(e,t){var n=t.ampSpectrum;return Math.sqrt(u(2,n)-Math.pow(u(1,n),2))},spectralSkewness:function(e,t,n){var r=t.ampSpectrum;var i=u(1,r);var s=u(2,r);var o=u(3,r);var a=2*Math.pow(i,3)-3*i*s+o;var f=Math.pow(Math.sqrt(s-Math.pow(i,2)),3);return a/f},spectralKurtosis:function(e,t){var n=t.ampSpectrum;var r=u(1,n);var i=u(2,n);var s=u(3,n);var o=u(4,n);var a=-3*Math.pow(r,4)+6*r*i-4*r*s+o;var f=Math.pow(Math.sqrt(i-Math.pow(r,2)),4);return a/f},amplitudeSpectrum:function(e,t){return t.ampSpectrum},zcr:function(e,t){var n=0;for(var r=0;r<t.signal.length;r++){if(t.signal[r]>=0&&t.signal[r+1]<0||t.signal[r]<0&&t.signal[r+1]>=0){n++}}return n},powerSpectrum:function(e,t){var n=new Float32Array(t.ampSpectrum.length);for(var r=0;r<n.length;r++){n[r]=Math.pow(t.ampSpectrum[r],2)}return n},loudness:function(e,t){var n=Float32Array(t.ampSpectrum.length);var r=24;var i=Float32Array(r);var s=0;var o=t.ampSpectrum;var u=new Int32Array(r+1);for(var a=0;a<n.length;a++){n[a]=a*t.audioContext.sampleRate/e;n[a]=13*Math.atan(n[a]/1315.8)+3.5*Math.atan(Math.pow(n[a]/7518,2))}u[0]=0;var f=n[t.ampSpectrum.length-1]/r;var l=1;for(var a=0;a<t.ampSpectrum.length;a++){while(n[a]>f){u[l++]=a;f=l*n[t.ampSpectrum.length-1]/r}}u[r]=t.ampSpectrum.length-1;for(var a=0;a<r;a++){var c=0;for(var h=u[a];h<u[a+1];h++){c+=o[h]}i[a]=Math.pow(c,.23)}for(var a=0;a<i.length;a++){s+=i[a]}return{specific:i,total:s}},perceptualSpread:function(e,t){var n=t.featureExtractors["loudness"](e,t);var r=0;for(var i=0;i<n.specific.length;i++){if(n.specific[i]>r){r=n.specific[i]}}var s=Math.pow((n.total-r)/n.total,2);return s},perceptualSharpness:function(e,t){var n=t.featureExtractors["loudness"](e,t);var r=n.specific;var i=0;for(var s=0;s<r.length;s++){if(s<15){i+=(s+1)*r[s+1]}else{i+=.066*Math.exp(.171*(s+1))}}i*=.11/n.total;return i},mfcc:function(t,n){var r=n.featureExtractors["powerSpectrum"](t,n);var i=function(e){var t=1125*Math.log(1+e/700);return t};var s=function(e){var t=700*(Math.exp(e/1125)-1);return t};var o=26;var u=Float32Array(o+2);var a=Float32Array(o+2);var f=0;var l=e.sampleRate/2;var c=i(f);var h=i(l);var p=h-c;var d=p/(o+1);var v=Array(o+2);for(var m=0;m<u.length;m++){u[m]=m*d;a[m]=s(u[m]);v[m]=Math.floor((t+1)*a[m]/e.sampleRate)}var g=Array(o);for(var y=0;y<g.length;y++){g[y]=Array.apply(null,new Array(t/2+1)).map(Number.prototype.valueOf,0);for(var m=v[y];m<v[y+1];m++){g[y][m]=(m-v[y])/(v[y+1]-v[y])}for(var m=v[y+1];m<v[y+2];m++){g[y][m]=(v[y+2]-m)/(v[y+2]-v[y+1])}}var b=new Float32Array(o);for(var m=0;m<b.length;m++){b[m]=0;for(var y=0;y<t/2;y++){g[m][y]=g[m][y]*r[y];b[m]+=g[m][y]}b[m]=Math.log(b[m])}for(var w=0;w<mfcc.length;w++){var E=0;for(var S=0;S<mfcc.length-1;S++){E+=mfcc[S]*Math.cos(Math.PI*w*(2*S+1)/(2*mfcc.length))}mfcc[w]=E}return b}};window.spn=e.createScriptProcessor(i,1,0);window.spn.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);l.signal=t;var n=f(l.signal);var u=new complex_array.ComplexArray(i);u.map(function(e,t,r){e.real=n[t]});var a=u.FFT();l.complexSpectrum=a;l.ampSpectrum=new Float32Array(i/2);for(var c=0;c<i/2;c++){l.ampSpectrum[c]=Math.sqrt(Math.pow(a.real[c],2)+Math.pow(a.imag[c],2))}if(typeof r==="function"&&s){r(l.get(o))}};l.start=function(e){o=e;s=true};l.stop=function(){s=false};l.audioContext=e;l.get=function(e){if(typeof e==="object"){var t={};for(var n=0;n<e.length;n++){try{t[e[n]]=l.featureExtractors[e[n]](i,l)}catch(r){console.error(r)}}return t}else if(typeof e==="string"){return l.featureExtractors[e](i,l)}else{throw"Invalid Feature Format"}};t.connect(window.spn,0,0);return l}else{if(typeof e=="undefined"){throw"AudioContext wasn't specified: Meyda will not run."}else{throw"Buffer size is not a power of two: Meyda will not run."}}}